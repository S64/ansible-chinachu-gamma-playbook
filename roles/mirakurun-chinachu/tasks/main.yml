- name: disable pcscd
  service:
    name: pcscd
    enabled: no
    state: stopped

- name: "add user `chinachu`"
  user:
    name: chinachu
    system: yes
    shell: /bin/bash
    home: /opt/chinachu
    createhome: yes

- name: clone dockerfiles
  become: yes
  become_user: chinachu
  git:
    repo: https://github.com/Chinachu/docker-mirakurun-chinachu.git
    dest: /opt/chinachu/docker-mirakurun-chinachu
    accept_hostkey: yes

- name: mkdir /opt/chinachu/.config/systemd/user
  file: dest=/opt/chinachu/.config/systemd/user state=directory

- name: copy mirakurun-chinachu.service
  become_user: chinachu
  template:
    src: mirakurun-chinachu.service.j2
    dest: /opt/chinachu/.config/systemd/user/mirakurun-chinachu.service
    mode: 0755

- name: enable mirakurun-chinachu
  systemd:
    name: mirakurun-chinachu
    enabled: yes
    user: yes
